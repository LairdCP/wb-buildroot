From 02d19e38464d299a63eddd0b40dee4d07bbdb9d0 Mon Sep 17 00:00:00 2001
From: Stefano Babic <sbabic@denx.de>
Date: Wed, 15 Apr 2020 13:29:09 +0200
Subject: [PATCH] Fix regression by introducing strlcpy

The implemented strlcpy is buggy, fixed it.

Signed-off-by: Stefano Babic <sbabic@denx.de>
---
 core/util.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/core/util.c b/core/util.c
index 86057cf90..0ed75ff03 100644
--- a/core/util.c
+++ b/core/util.c
@@ -197,12 +197,17 @@ strlcpy(char *dst, const char * src, size_t size)
 {
 
     size_t len = strlen(src);
+    /*
+     * src is null termintaed,
+     * copy the last '\0', too.
+     */
     if (len < size) {
         memcpy(dst, src, len + 1);
     } else if (len) {
-        memcpy(dst, src, len - 1);
+	/* truncate string */
+        memcpy(dst, src, size - 1);
 	/* Add C string terminator */
-        dst[len - 1] = '\0';
+        dst[size - 1] = '\0';
     }
     return len;
 }
